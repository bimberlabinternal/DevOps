<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
		xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd">

	<bean id="pipelineJobService" class="org.labkey.pipeline.api.PipelineJobServiceImpl">		
		<property name="remoteExecutionEngines">
			<list>
				<bean id="slurmSSHEngine" class="org.labkey.cluster.pipeline.SlurmExecutionEngine">
					<constructor-arg type="org.labkey.cluster.pipeline.SlurmExecutionEngineConfig" ref="slurmSSHProperties"/>
				</bean>
			</list>
		</property>

                <property name="configProperties">
                        <bean class="org.labkey.pipeline.api.properties.ConfigPropertiesImpl">
                                <property name="softwarePackages">
                                        <map>
                                                <entry key="PERLPATH" value="/bin"/>
                                       </map>
                                </property>
                        </bean>
		</property>
	</bean>

	<bean id="slurmSSHProperties" class="org.labkey.cluster.pipeline.SlurmExecutionEngineConfig">
		<property name="location" value="slurm" />
		<property name="submitCommand" value="ssh -q labkey_submit@exacloud.ohsu.edu /usr/bin/sbatch -A ${clusterUser} '${submitScript}'"/>
		<property name="statusCommand" value="ssh -q labkey_submit@exacloud.ohsu.edu /usr/bin/squeue --all"/>
		<property name="removeCommand" value="ssh -q labkey_submit@exacloud.ohsu.edu /usr/bin/scancel ${clusterId} -O -o JobId,State,NodeList"/>
		<property name="historyCommand" value="ssh -q labkey_submit@exacloud.ohsu.edu /usr/bin/sacct --allusers --jobs=${clusterId} -o JobId,State,NodeList"/>

		<property name="labKeyDir" value="/home/exacloud/lustre1/prime-seq/src/" />
		<property name="remoteExecutable" value="/home/exacloud/lustre1/prime-seq/src/javaWrapper.sh" />

		<!--
		<property name="labKeyDir" value="/home/groups/prime-seq/exacloud/code/labkey/" />
                <property name="remoteExecutable" value="/home/groups/prime-seq/exacloud/code/labkey/javaWrapper.sh" />
		-->

		<property name="requestMemory" value="36" />
		<property name="requestCpus" value="8" />
		<property name="javaHome" value="/home/groups/prime-seq/exacloud/java/current"/>
	        <property name="javaOpts">
			<list>
				<value>-Xmx8g</value>
			</list>
		</property>
                <property name="extraSubmitScriptLines">
                        <list>
                                <value>#SBATCH --partition=exacloud</value>
				<value>#SBATCH --time=2160</value>
				<value>#SBATCH --gres=disk:1024</value>
                        </list>
                </property>
	</bean>
</beans>
